rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Comments Collection - Universal review system
    match /Comments/{commentId} {
      // Allow users to create comments/reviews with strict validation
      allow create: if request.resource.data.status == 'pending'
                    && request.resource.data.userName is string
                    && request.resource.data.userName.size() >= 2
                    && request.resource.data.userName.size() <= 50
                    && request.resource.data.commentText is string
                    && request.resource.data.commentText.size() >= 10
                    && request.resource.data.commentText.size() <= 500
                    && request.resource.data.announcementId is string
                    && request.resource.data.targetType is string
                    && request.resource.data.targetType in ['announcement', 'university', 'hospital', 'mall', 'restaurant', 'hotel', 'place']
                    && request.resource.data.timestamp == request.time;
      
      // Allow anyone to read ONLY approved comments
      // Announcement comments (private feedback) stay pending forever
      // Directory reviews (public) are approved by admin and become visible
      allow read: if resource.data.status == 'approved';
      
      // Only admins can update/delete (not implemented yet)
      // For now, admin manages via Firebase Console
      allow update, delete: if false;
    }
    
    // Announcements Collection (read-only for app users)
    // Note: Collection name has typo 'annoucments' to match existing DB
    match /annoucments/{announcementId} {
      // Anyone can read announcements
      allow read: if true;
      
      // Only admins can write (via Firebase Console)
      allow write: if false;
    }
    
    // Council Collection (read-only)
    match /Council/{memberId} {
      allow read: if true;
      allow write: if false;
    }
    
    // OversightCommittee Collection (read-only)
    match /OversightCommittee/{memberId} {
      allow read: if true;
      allow write: if false;
    }
    
    // Other collections - default deny for security
    // Add specific rules as needed for other collections
    match /{document=**} {
      allow read: if true;  // Adjust based on your security needs
      allow write: if false; // Prevent unauthorized writes
    }
  }
}
